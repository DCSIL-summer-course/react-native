# Getting Started

[Follow the first page of the getting started guide on React Native](https://facebook.github.io/react-native/docs/getting-started.html)

**If you are on a windows machine you can only develop an Android app.**

**If you are on a Mac I recommend downloading [Nuclide](http://nuclide.io/docs/quick-start/getting-started/), an IDE created by Facebook for React Native**.


## Initializing the project

```
react-native init NativeReddit
```

## Installing the dependencies

Enter the folder you just created above, `NativeReddit`:

```
cd NativeReddit
```

Then install the following 4 modules (`--save` saves references to each module in your `package.json` file).

```
npm install redux react-redux redux-thunk isomorphic-fetch --save
```

# Reddit Native

[Background]

# Creating the Native Reddit App

Open the `NativeReddit` folder in the IDE/text editor of your choice (e.g. Nuclide/Atom/Sublime).

`NativeReddit/index.ios.js` is the entry point to your app if you build an iOS app while `NativeReddit/index.android.js` is the entry point to your app if you build an Android app. I'll refer to the index file as `index.*.js` and if you are building an Android app you'll refer to the `index.android.js` file while if you are building an iOS app you will refer to `index.ios.js`.

## Creating our first native component

We'll start by creating a top navigation bar that will initially hold the current view's title.

In `NativeReddit` create a folder called `components` then create the file `components/reddit-nav-bar.js` (React Native does not recognize `.jsx` extensions, so we'll stick to `.js`).

First we'll import all the modules needed to build our own module:

```javascript
import React, { Component } from 'react';
import {
  StyleSheet,
  Text,
  View
} from 'react-native';
```

To create the component we'll use an `ES6` class and extend React Native's `Component` class. The class will include two methods `constructor()` and `render()`:

```javascript
class RedditNavigationBar extends Component {
  constructor(props){
    super(props);
    this.title = props.title;
  }

  render(){
    return (
      <View>
        <View style={styles.toolbar}>
          <Text style={styles.title}>{this.title}</Text>
        </View>
      </View>
    );
  }
}
```

In the constructor we pass the `props` to the parent's class using `super(props)`.

The `render()` function is what returns the UI for this component. Note that we are no longer using `<div>`'s, `<View>`'s and `<Text>` are actual native UI elements that React Native will create for us. 

Next we create the constant to hold the styles that our component requires:

```javascript
const styles = StyleSheet.create({
  toolbar: {
    backgroundColor: '#CFE3FA',
    paddingTop: 30,
    paddingBottom: 10,
    flexDirection: 'row'
  },
  title: {
    fontSize: 18,
    color: '#fff',
    textAlign: 'center',
    flex: 1
  }
});
```

React Native uses properties that are very similar to CSS and converts them to their analogues in Native. React Native also uses the Flex Box model for layout. 

`flex: 1` means that the title element should take up the width of our toolbar. If there were two elements in the tool bar and each had `flex: 1` that would mean that each gets 50% of the toolbar.

Finally, on the last line of `reddit-nav-bar.js` export our component:

```javascript
export default RedditNavigationBar;
```

## Using our new component

Open `index.*.js` and add the following import after the `'react-native'` imports:

```javascript
import RedditNavigationBar from './components/reddit-nav-bar.js';
```

Now update the autogenerated `NativeReddit` component to look like:

```javascript
class NativeReddit extends Component {
  render() {
    return (
      <View style={styles.outerContainer}>
        <RedditNavigationBar title="Reddit" />
      </View>
    );
  }
}
```

Above we use our new `RedditNavigationBar` component and pass it a title property of `"Reddit"`.

Finally, update the styles constant in `index.*.js` to look like:

```javascript
const styles = StyleSheet.create({
  outerContainer: {
    flex: 1
  },
  container: {
    flex: 1
  }
});
```

If everything is working you should see a light blue navigation bar with the title "Reddit".

## Creating our list of Reddit top stories

In `components/` create the file `components/reddit-list.js`  There are several new concepts that we'll need in order to build our list of Reddit stories. We'll improve the component incrementally.

First we'll start by importing the necessary modules and creating a constant to hold a couple Reddit stories for testing.

```javascript
import React, { Component } from 'react';
import {
  StyleSheet,
  Text,
  View,
  ListView,
  Image
} from 'react-native';

const REDDIT_STORIES = [
  {
    title: 'Got another dog yesterday (right), he\'s settling in well!',
    thumbnail: 'https://b.thumbs.redditmedia.com/5SOQ6sNiqEyqh48M9MOgM6sZmj-5iejiddLuRhPkWxA.jpg'},
  {
    title: 'We found this gal constantly stealing from our peach trees, so we named her Peaches. (Very original, I know)',
    thumbnail: 'https://b.thumbs.redditmedia.com/8ZkujfQt-MmvxoB_oQdq5DOgT3L3VkaeBDz_O40MzTk.jpg'}
];
```

Next we'll create, `RedditList`, the component that will contain a `ListView` of all our Reddit top stories:

```javascript
class RedditList extends Component {
  constructor(props){
    super(props)
    var ds = new ListView.DataSource({rowHasChanged: (r1, r2) => r1 !== r2});
    this.state = {
      dataSource: ds.cloneWithRows(REDDIT_STORIES)
    };
  }

  renderRow(rowData){
    return (
      <View style={styles.row}>
        <Image style={styles.image} source={{uri: rowData.thumbnail}} />
        <View style={styles.rightColumn}>
          <Text style={styles.title}>{rowData.title}</Text>
        </View>
      </View>
    );
  }

  render() {
    return (
      <ListView
        enableEmptySections={true}
        dataSource={this.state.dataSource}
        renderRow={this.renderRow}
      />
    );
  }
}
```

In the constructor we instantiate a `DataSource` object and pass a function through that specifiies the condition for a row value changing (the condition necessary for re-rendering a row). Then we'll use the `cloneWithRows()` function, passing in our Reddit stories, to seed our dataSource. Finally, we assign this data to the component's `state` object. Components are generally more performant, and easier easier to reason, when they don't have an internal state, but sometimes it's impossible to avoid not having a state.

Finally, in the bottom of the same file we'll create the `styles` and export our module:

```javascript
const styles = StyleSheet.create({
  row: {
    borderBottomWidth: 1,
    borderBottomColor: '#ddd',
    paddingTop: 4,
    paddingBottom: 4,
    flex: 1,
    flexDirection: 'row'
  },
  rightColumn: {
    flex: 1,
    paddingLeft: 5
  },
  title: {
    fontSize: 16
  },
  image: {
    width: 100,
    height: 100
  }
});

export default RedditList;
```

In `index.*.js` you can import the new module:

```javascript
import RedditList from './components/reddit-list.js';
```

Now update the `render()` function in `NativeReddit` to include our `RedditList` component:

```javascript
render() {
  return (
    <View style={styles.outerContainer}>
      <RedditNavigationBar title="Reddit" />
      <View style={styles.container}>
        <RedditList />
      </View>
    </View>
  );
} 
```

If everything is working you should see two Reddit stories, each with their own thumbnail.

## Moving our nav bar to the `RedditList` Component

In our final app their will be a back button in the navigation bar. However, the back button will be conditional on what page is currently visible. There are several different ways we can accomplish this, but for the purpose of this workshop we're going to move `<RedditNavigationBar title="Reddit" />` from index.*.js into `RedditList`.

In `reddit-list.js` add the following import:

```javascript
import RedditNavigationBar from './reddit-nav-bar.js';
```

Then update the render method to:

```javascript
render() {
  return (
    <View style={styles.outerContainer}>
      <RedditNavigationBar title="Reddit" showBackButton={false}/>
      <View style={styles.container}>
        <ListView
          enableEmptySections={true}
          dataSource={this.state.dataSource}
          renderRow={(rowData) => this.renderRow(rowData)}
        />
      </View>
    </View>
  );
}
```

Update the style object to include:

```javascript
outerContainer: {
  flex: 1,
  backgroundColor: '#fff'
},
container: {
  flex: 1,
},
```
 
 In `index.*.js` update the `render()` method to:
 
 ```javascript
 render(){
   return (
     <RedditList />
   );
 }
 ```
 
Finally remove the styles constant and Style import, as they're no longer needed in `index.*.js`.

You should still see the navbar with the list of 2 Reddit stories.
  
## Comments View

When a user clicks on a single story they should be taken to the comments view for that story. To make this work we'll first create a `RedditComments` component and then we'll integrate navigation into our app. In `components/` create `reddit-comments.js` and add the following imports and const:

```javascript
import React, { Component } from 'react';
import {
  StyleSheet,
  Text,
  View,
  ListView,
  Image
} from 'react-native';

import RedditNavigationBar from './reddit-nav-bar.js';

const REDDIT_COMMENTS = [
  {text: 'lol'},
  {text: 'ftw'}
];
```

Our `RedditComments` component will be very similar to the `RedditList` component. **Try to do this on your own - it's almost the same!**

### `RedditComment` Cheat

```javascript
class RedditComments extends Component {
  constructor(props){
    super(props);
    var ds = new ListView.DataSource({rowHasChanged: (r1, r2) => r1 !== r2});
    this.state = {
      dataSource: ds.cloneWithRows(REDDIT_COMMENTS)
    };
  }

  renderRow(rowData){
    return (
      <View style={styles.row}>
        <Text>{rowData.text}</Text>
      </View>
    );
  }

  render(){
    return (
      <View style={styles.outerContainer}>
        <RedditNavigationBar title="Reddit"/>
        <View style={styles.container}>
          <Text>Article!</Text>
          <ListView
            enableEmptySections={true}
            dataSource={this.state.dataSource}
            renderRow={this.renderRow}
          />
        </View>
      </View>
    );
  }
}
```

The styles and the export:

```javascript
const styles = StyleSheet.create({
  outerContainer: {
    flex: 1,
    backgroundColor: '#fff'
  },
  container: {
    flex: 1,
  },
  row: {
    borderBottomWidth: 1,
    borderBottomColor: '#ddd',
    paddingTop: 4,
    paddingBottom: 4,
    flex: 1
  }
});

export default RedditComments;
```

You'll notice that we have the exact same `outerContainer` and `container` style defined in `reddit-list.js` and `reddit-comments.js`, we should move these to their own module and shared between pages. For this workshop we'll skip this step.

In `index.*.js` add the `RedditComments` import:

```javascript
import RedditComments from './components/reddit-comments.js';
```

At this point you have no way of viewing your new comments page. Let's fix that!

## App Navigation

**WARNING**: React Native's Navigation is going through some big changes, what you see below may not work in versions > 0.26.x.

In `index.*.js` update your `'react-native'` import to look like:

```javascript
import {
  AppRegistry,
  Navigator
} from 'react-native';
```

In `NativeReddit` update the render method to use the new `Navigator` element:

```javascript
render() {
  return (
    <Navigator
     initialRoute={{name: 'RedditList'}}
     renderScene={this.renderScene}
    />
  );
}
```

You'll note that we're specifying the `initialRoute` (e.g. the starting point). The name `RedditList` will make sense shortly. Next we specify a function, `this.renderScene` that will render the scene when the scene changes. We'll need to go ahead and add `renderScene` to our `NativeReddit` class.

```javascript
  renderScene(route, navigator){
      switch (route.name) {
        case 'RedditList':
          return <RedditList navigator={navigator} {...route.passProps} />
        case 'RedditComments':
          return <RedditComments navigator={navigator} {...route.passProps} />
        default:
          return <RedditList navigator={navigator} {...route.passProps} />
      }
  }
```

`renderScene` accepts to parameters: 1) `route`, which contains the routes name, and `navigator`, an object that helps us navigate through our app. The `renderScene` function is effectly a router that matches a given "scene" for a given `route.name`. It passes the `navigator` object to that seen and it passes any parameters that may have been passed from one scene to another using the spread operator `{...route.passedParams}`.